'use strict';

function boomifyMethod(ctrlMethod) {
  return function (req, res) {
    var proxiedResponse = {
      status: function status(num) {
        res.status(num);
      },
      send: function send(payload) {
        if (payload.isBoom) {
          res.status(payload.output.statusCode);
          return res.send(payload.output.payload);
        }
        res.send(payload);
      }
    };

    ctrlMethod(req, proxiedResponse);
  };
}

function boomify(ctrl, methodName) {
  if (!ctrl) {
    throw new Error('Controller is required.');
  }

  if (methodName && typeof ctrl[methodName] === 'function') {
    ctrl[methodName] = boomifyMethod(ctrl[methodName]);
    return ctrl;
  } else if (methodName) {
    throw new Error(methodName + ' not found on Controller.');
  }

  var boomifiedCtrl = {};
  for (var i in ctrl) {
    if (typeof ctrl[i] === 'function') {
      boomifiedCtrl[i] = boomifyMethod(ctrl[i]);
    }
  }
  return boomifiedCtrl;
}

module.exports = boomify;